<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PyHelios: Radiation Model Plugin</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="pyhelios-custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="PyHelios_logo_whiteborder.png"/></td>
  <td id="projectalign">
   <div id="projectname">PyHelios
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('RadiationDoc.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Radiation Model Plugin</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_docs_2plugin__radiation"></a></p>
<p>The Radiation Model plugin provides GPU-accelerated ray tracing for radiation simulation using OptiX. This documentation is based on the actual implementation.</p>
<h1><a class="anchor" id="autotoc_md220"></a>
Overview</h1>
<p>The RadiationModel class provides advanced radiation modeling and ray tracing capabilities for realistic light interaction simulations in plant canopies and scenes.</p>
<h1><a class="anchor" id="autotoc_md221"></a>
Requirements</h1>
<p>The radiation plugin requires:</p><ul>
<li>NVIDIA GPU with CUDA support</li>
<li>CUDA Toolkit installed</li>
<li>OptiX runtime (bundled with PyHelios)</li>
</ul>
<h1><a class="anchor" id="autotoc_md222"></a>
Basic Usage</h1>
<div class="fragment"><div class="line"><span class="keyword">from</span> pyhelios <span class="keyword">import</span> Context, RadiationModel, RadiationModelError</div>
<div class="line"><span class="keyword">from</span> pyhelios <span class="keyword">import</span> DataTypes</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Create context with geometry</span></div>
<div class="line">context = Context()</div>
<div class="line">patch_uuid = context.addPatch(</div>
<div class="line">    center=DataTypes.vec3(0, 0, 0),</div>
<div class="line">    size=DataTypes.vec2(2, 2),</div>
<div class="line">    color=DataTypes.RGBcolor(0.3, 0.7, 0.2)</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Use RadiationModel with context manager (recommended)</span></div>
<div class="line"><span class="keyword">with</span> RadiationModel(context) <span class="keyword">as</span> radiation:</div>
<div class="line">    <span class="comment"># Add radiation band</span></div>
<div class="line">    radiation.add_radiation_band(<span class="stringliteral">&quot;PAR&quot;</span>)</div>
<div class="line">    </div>
<div class="line">    <span class="comment"># Add radiation source</span></div>
<div class="line">    source_id = radiation.add_collimated_radiation_source()</div>
<div class="line">    radiation.set_source_flux(source_id, <span class="stringliteral">&quot;PAR&quot;</span>, 1000.0)</div>
<div class="line">    </div>
<div class="line">    <span class="comment"># Configure ray counts</span></div>
<div class="line">    radiation.set_direct_ray_count(<span class="stringliteral">&quot;PAR&quot;</span>, 100)</div>
<div class="line">    radiation.set_diffuse_ray_count(<span class="stringliteral">&quot;PAR&quot;</span>, 300)</div>
<div class="line">    </div>
<div class="line">    <span class="comment"># Run simulation</span></div>
<div class="line">    radiation.run_band(<span class="stringliteral">&quot;PAR&quot;</span>)</div>
<div class="line">    </div>
<div class="line">    <span class="comment"># Get results</span></div>
<div class="line">    results = radiation.get_total_absorbed_flux()</div>
<div class="line">    print(f<span class="stringliteral">&quot;Total absorbed flux: {sum(results)} W&quot;</span>)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md223"></a>
Radiation Bands</h1>
<h2><a class="anchor" id="autotoc_md224"></a>
Basic Band Management</h2>
<div class="fragment"><div class="line"><span class="comment"># Add radiation bands (verified methods)</span></div>
<div class="line">radiation.add_radiation_band(<span class="stringliteral">&quot;PAR&quot;</span>)</div>
<div class="line">radiation.add_radiation_band(<span class="stringliteral">&quot;NIR&quot;</span>)</div>
<div class="line">radiation.add_radiation_band(<span class="stringliteral">&quot;SW&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Add band with wavelength bounds</span></div>
<div class="line">radiation.add_radiation_band_with_wavelengths(<span class="stringliteral">&quot;custom&quot;</span>, 400.0, 700.0)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Copy existing band</span></div>
<div class="line">radiation.copy_radiation_band(<span class="stringliteral">&quot;PAR&quot;</span>, <span class="stringliteral">&quot;PAR_copy&quot;</span>)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md225"></a>
Common Radiation Bands</h2>
<div class="fragment"><div class="line"><span class="comment"># Standard radiation bands for plant modeling</span></div>
<div class="line">bands = {</div>
<div class="line">    <span class="stringliteral">&quot;PAR&quot;</span>: <span class="stringliteral">&quot;Photosynthetically Active Radiation (400-700 nm)&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;NIR&quot;</span>: <span class="stringliteral">&quot;Near Infrared (700-1100 nm)&quot;</span>, </div>
<div class="line">    <span class="stringliteral">&quot;SW&quot;</span>: <span class="stringliteral">&quot;Shortwave (300-3000 nm)&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;UV&quot;</span>: <span class="stringliteral">&quot;Ultraviolet (280-400 nm)&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;VIS&quot;</span>: <span class="stringliteral">&quot;Visible (380-750 nm)&quot;</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> band, description <span class="keywordflow">in</span> bands.items():</div>
<div class="line">    radiation.add_radiation_band(band)</div>
<div class="line">    print(f<span class="stringliteral">&quot;Added {band}: {description}&quot;</span>)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md226"></a>
Radiation Sources</h1>
<h2><a class="anchor" id="autotoc_md227"></a>
Collimated Sources</h2>
<div class="fragment"><div class="line"><span class="comment"># Default collimated source (verified methods)</span></div>
<div class="line">source_id = radiation.add_collimated_radiation_source()</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Source with specific direction vector</span></div>
<div class="line">source_id = radiation.add_collimated_radiation_source(</div>
<div class="line">    direction=(0.3, 0.3, -0.9)  <span class="comment"># Sun angle</span></div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Set source flux</span></div>
<div class="line">radiation.set_source_flux(source_id, <span class="stringliteral">&quot;PAR&quot;</span>, 1200.0)  <span class="comment"># W/m²</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md228"></a>
Spherical Sources</h2>
<div class="fragment"><div class="line"><span class="comment"># Spherical radiation source</span></div>
<div class="line">source_id = radiation.add_sphere_radiation_source(</div>
<div class="line">    position=(0, 0, 10),  <span class="comment"># x, y, z position</span></div>
<div class="line">    radius=0.5            <span class="comment"># Source radius</span></div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Set flux for spherical source</span></div>
<div class="line">radiation.set_source_flux(source_id, <span class="stringliteral">&quot;PAR&quot;</span>, 800.0)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md229"></a>
Sun Sources</h2>
<div class="fragment"><div class="line"><span class="comment"># Realistic sun modeling</span></div>
<div class="line">sun_id = radiation.add_sun_sphere_radiation_source(</div>
<div class="line">    radius=0.5,           <span class="comment"># Sun disc radius</span></div>
<div class="line">    zenith=45.0,          <span class="comment"># Sun zenith angle (degrees)</span></div>
<div class="line">    azimuth=180.0,        <span class="comment"># Sun azimuth angle (degrees)</span></div>
<div class="line">    position_scaling=1.0, <span class="comment"># Position scaling factor</span></div>
<div class="line">    angular_width=0.53,   <span class="comment"># Sun angular width (degrees)</span></div>
<div class="line">    flux_scaling=1.0      <span class="comment"># Flux scaling factor</span></div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Set solar flux</span></div>
<div class="line">radiation.set_source_flux(sun_id, <span class="stringliteral">&quot;PAR&quot;</span>, 1200.0)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md230"></a>
Flux Configuration</h1>
<h2><a class="anchor" id="autotoc_md231"></a>
Source Flux Management</h2>
<div class="fragment"><div class="line"><span class="comment"># Single source flux</span></div>
<div class="line">radiation.set_source_flux(source_id, <span class="stringliteral">&quot;PAR&quot;</span>, 1000.0)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Multiple sources with same flux</span></div>
<div class="line">source_ids = [source1, source2, source3]</div>
<div class="line">radiation.set_source_flux_multiple(source_ids, <span class="stringliteral">&quot;PAR&quot;</span>, 800.0)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Get current source flux</span></div>
<div class="line">current_flux = radiation.get_source_flux(source_id, <span class="stringliteral">&quot;PAR&quot;</span>)</div>
<div class="line">print(f<span class="stringliteral">&quot;Source flux: {current_flux} W/m²&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Diffuse radiation flux</span></div>
<div class="line">radiation.set_diffuse_radiation_flux(<span class="stringliteral">&quot;PAR&quot;</span>, 200.0)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md232"></a>
Ray Configuration</h1>
<h2><a class="anchor" id="autotoc_md233"></a>
Ray Count Settings</h2>
<div class="fragment"><div class="line"><span class="comment"># Configure ray counts for accuracy vs. performance</span></div>
<div class="line">radiation.set_direct_ray_count(<span class="stringliteral">&quot;PAR&quot;</span>, 1000)    <span class="comment"># Direct rays</span></div>
<div class="line">radiation.set_diffuse_ray_count(<span class="stringliteral">&quot;PAR&quot;</span>, 3000)   <span class="comment"># Diffuse rays</span></div>
<div class="line"> </div>
<div class="line"><span class="comment"># Higher ray counts for better accuracy</span></div>
<div class="line">radiation.set_direct_ray_count(<span class="stringliteral">&quot;PAR&quot;</span>, 5000)</div>
<div class="line">radiation.set_diffuse_ray_count(<span class="stringliteral">&quot;PAR&quot;</span>, 10000)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md234"></a>
Ray Count Guidelines</h2>
<div class="fragment"><div class="line"><span class="comment"># Performance vs accuracy trade-offs</span></div>
<div class="line">ray_configs = {</div>
<div class="line">    <span class="stringliteral">&quot;fast&quot;</span>: {<span class="stringliteral">&quot;direct&quot;</span>: 100, <span class="stringliteral">&quot;diffuse&quot;</span>: 300},</div>
<div class="line">    <span class="stringliteral">&quot;standard&quot;</span>: {<span class="stringliteral">&quot;direct&quot;</span>: 1000, <span class="stringliteral">&quot;diffuse&quot;</span>: 3000}, </div>
<div class="line">    <span class="stringliteral">&quot;high_quality&quot;</span>: {<span class="stringliteral">&quot;direct&quot;</span>: 5000, <span class="stringliteral">&quot;diffuse&quot;</span>: 15000},</div>
<div class="line">    <span class="stringliteral">&quot;research&quot;</span>: {<span class="stringliteral">&quot;direct&quot;</span>: 10000, <span class="stringliteral">&quot;diffuse&quot;</span>: 30000}</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Apply configuration</span></div>
<div class="line">config = ray_configs[<span class="stringliteral">&quot;standard&quot;</span>]</div>
<div class="line">radiation.set_direct_ray_count(<span class="stringliteral">&quot;PAR&quot;</span>, config[<span class="stringliteral">&quot;direct&quot;</span>])</div>
<div class="line">radiation.set_diffuse_ray_count(<span class="stringliteral">&quot;PAR&quot;</span>, config[<span class="stringliteral">&quot;diffuse&quot;</span>])</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md235"></a>
Advanced Configuration</h1>
<h2><a class="anchor" id="autotoc_md236"></a>
Scattering Control</h2>
<div class="fragment"><div class="line"><span class="comment"># Set scattering depth (number of bounces)</span></div>
<div class="line">radiation.set_scattering_depth(<span class="stringliteral">&quot;PAR&quot;</span>, 3)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Set minimum scatter energy threshold</span></div>
<div class="line">radiation.set_min_scatter_energy(<span class="stringliteral">&quot;PAR&quot;</span>, 0.01)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md237"></a>
Emission Control</h2>
<div class="fragment"><div class="line"><span class="comment"># Enable/disable emission for thermal radiation</span></div>
<div class="line">radiation.enable_emission(<span class="stringliteral">&quot;thermal&quot;</span>)</div>
<div class="line">radiation.disable_emission(<span class="stringliteral">&quot;PAR&quot;</span>)  <span class="comment"># PAR typically doesn&#39;t emit</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md238"></a>
Simulation Execution</h1>
<h2><a class="anchor" id="autotoc_md239"></a>
Geometry Updates</h2>
<div class="fragment"><div class="line"><span class="comment"># Update all geometry before simulation</span></div>
<div class="line">radiation.update_geometry()</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Update specific geometry UUIDs</span></div>
<div class="line">radiation.update_geometry([patch_uuid, triangle_uuid])</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md240"></a>
Running Simulations</h2>
<div class="fragment"><div class="line"><span class="comment"># Run single band</span></div>
<div class="line">radiation.run_band(<span class="stringliteral">&quot;PAR&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Run multiple bands</span></div>
<div class="line">radiation.run_bands([<span class="stringliteral">&quot;PAR&quot;</span>, <span class="stringliteral">&quot;NIR&quot;</span>, <span class="stringliteral">&quot;SW&quot;</span>])</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md241"></a>
Results and Analysis</h1>
<h2><a class="anchor" id="autotoc_md242"></a>
Flux Results</h2>
<div class="fragment"><div class="line"><span class="comment"># Get total absorbed flux for all primitives</span></div>
<div class="line">results = radiation.get_total_absorbed_flux()</div>
<div class="line">total_absorption = sum(results)</div>
<div class="line">print(f<span class="stringliteral">&quot;Total absorbed flux: {total_absorption:.2f} W&quot;</span>)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Analyze results per primitive</span></div>
<div class="line">all_uuids = context.getAllUUIDs()</div>
<div class="line"><span class="keywordflow">for</span> i, uuid <span class="keywordflow">in</span> enumerate(all_uuids):</div>
<div class="line">    <span class="keywordflow">if</span> i &lt; len(results):</div>
<div class="line">        flux = results[i]</div>
<div class="line">        area = context.getPrimitiveArea(uuid)</div>
<div class="line">        flux_density = flux / area <span class="keywordflow">if</span> area &gt; 0 <span class="keywordflow">else</span> 0</div>
<div class="line">        print(f<span class="stringliteral">&quot;Primitive {uuid}: {flux:.2f} W ({flux_density:.2f} W/m²)&quot;</span>)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md243"></a>
Radiation Analysis</h2>
<div class="fragment"><div class="line"><span class="comment"># Calculate radiation statistics</span></div>
<div class="line">radiation_data = radiation.get_total_absorbed_flux()</div>
<div class="line"> </div>
<div class="line"><span class="keyword">import</span> statistics</div>
<div class="line">mean_flux = statistics.mean(radiation_data)</div>
<div class="line">max_flux = max(radiation_data)</div>
<div class="line">min_flux = min(radiation_data)</div>
<div class="line">std_flux = statistics.stdev(radiation_data)</div>
<div class="line"> </div>
<div class="line">print(f<span class="stringliteral">&quot;Radiation statistics:&quot;</span>)</div>
<div class="line">print(f<span class="stringliteral">&quot;  Mean: {mean_flux:.2f} W&quot;</span>)</div>
<div class="line">print(f<span class="stringliteral">&quot;  Max: {max_flux:.2f} W&quot;</span>) </div>
<div class="line">print(f<span class="stringliteral">&quot;  Min: {min_flux:.2f} W&quot;</span>)</div>
<div class="line">print(f<span class="stringliteral">&quot;  Std Dev: {std_flux:.2f} W&quot;</span>)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md244"></a>
Complete Workflow Example</h1>
<div class="fragment"><div class="line"><span class="keyword">from</span> pyhelios <span class="keyword">import</span> Context, WeberPennTree, WPTType, RadiationModel, DataTypes</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Create scene</span></div>
<div class="line">context = Context()</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Add ground plane</span></div>
<div class="line">ground_uuid = context.addPatch(</div>
<div class="line">    center=DataTypes.vec3(0, 0, 0),</div>
<div class="line">    size=DataTypes.vec2(10, 10),</div>
<div class="line">    color=DataTypes.RGBcolor(0.3, 0.2, 0.1)</div>
<div class="line">)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Generate tree</span></div>
<div class="line">wpt = WeberPennTree(context)</div>
<div class="line">tree_id = wpt.buildTree(WPTType.LEMON)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Run radiation simulation</span></div>
<div class="line"><span class="keywordflow">try</span>:</div>
<div class="line">    <span class="keyword">with</span> RadiationModel(context) <span class="keyword">as</span> radiation:</div>
<div class="line">        <span class="comment"># Configure radiation</span></div>
<div class="line">        radiation.add_radiation_band(<span class="stringliteral">&quot;PAR&quot;</span>)</div>
<div class="line">        </div>
<div class="line">        <span class="comment"># Add sun</span></div>
<div class="line">        sun_id = radiation.add_sun_sphere_radiation_source(</div>
<div class="line">            radius=0.5,</div>
<div class="line">            zenith=30.0,    <span class="comment"># Morning sun</span></div>
<div class="line">            azimuth=135.0   <span class="comment"># Southeast</span></div>
<div class="line">        )</div>
<div class="line">        radiation.set_source_flux(sun_id, <span class="stringliteral">&quot;PAR&quot;</span>, 1200.0)</div>
<div class="line">        </div>
<div class="line">        <span class="comment"># Add diffuse sky radiation</span></div>
<div class="line">        radiation.set_diffuse_radiation_flux(<span class="stringliteral">&quot;PAR&quot;</span>, 200.0)</div>
<div class="line">        </div>
<div class="line">        <span class="comment"># Configure simulation quality</span></div>
<div class="line">        radiation.set_direct_ray_count(<span class="stringliteral">&quot;PAR&quot;</span>, 2000)</div>
<div class="line">        radiation.set_diffuse_ray_count(<span class="stringliteral">&quot;PAR&quot;</span>, 6000)</div>
<div class="line">        radiation.set_scattering_depth(<span class="stringliteral">&quot;PAR&quot;</span>, 2)</div>
<div class="line">        </div>
<div class="line">        <span class="comment"># Run simulation</span></div>
<div class="line">        radiation.update_geometry()</div>
<div class="line">        radiation.run_band(<span class="stringliteral">&quot;PAR&quot;</span>)</div>
<div class="line">        </div>
<div class="line">        <span class="comment"># Analyze results</span></div>
<div class="line">        results = radiation.get_total_absorbed_flux()</div>
<div class="line">        </div>
<div class="line">        <span class="comment"># Get leaf-specific results</span></div>
<div class="line">        leaf_uuids = wpt.getLeafUUIDs(tree_id)</div>
<div class="line">        leaf_absorption = 0</div>
<div class="line">        </div>
<div class="line">        all_uuids = context.getAllUUIDs()</div>
<div class="line">        <span class="keywordflow">for</span> i, uuid <span class="keywordflow">in</span> enumerate(all_uuids):</div>
<div class="line">            <span class="keywordflow">if</span> uuid <span class="keywordflow">in</span> leaf_uuids <span class="keywordflow">and</span> i &lt; len(results):</div>
<div class="line">                leaf_absorption += results[i]</div>
<div class="line">        </div>
<div class="line">        print(f<span class="stringliteral">&quot;Total scene absorption: {sum(results):.2f} W&quot;</span>)</div>
<div class="line">        print(f<span class="stringliteral">&quot;Leaf absorption: {leaf_absorption:.2f} W&quot;</span>)</div>
<div class="line">        print(f<span class="stringliteral">&quot;Ground absorption: {results[all_uuids.index(ground_uuid)]:.2f} W&quot;</span>)</div>
<div class="line">        </div>
<div class="line"><span class="keywordflow">except</span> RadiationModelError <span class="keyword">as</span> e:</div>
<div class="line">    print(f<span class="stringliteral">&quot;Radiation simulation failed: {e}&quot;</span>)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md245"></a>
Integration with Other Components</h1>
<h2><a class="anchor" id="autotoc_md246"></a>
With WeberPennTree</h2>
<div class="fragment"><div class="line"><span class="comment"># Generate tree and analyze radiation interception</span></div>
<div class="line">tree_id = wpt.buildTree(WPTType.OLIVE)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Run radiation</span></div>
<div class="line">radiation.run_band(<span class="stringliteral">&quot;PAR&quot;</span>)</div>
<div class="line">results = radiation.get_total_absorbed_flux()</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Calculate tree radiation budget</span></div>
<div class="line">leaf_uuids = wpt.getLeafUUIDs(tree_id)</div>
<div class="line">branch_uuids = wpt.getBranchUUIDs(tree_id)</div>
<div class="line"> </div>
<div class="line">total_leaf_interception = 0</div>
<div class="line">total_branch_interception = 0</div>
<div class="line"> </div>
<div class="line">all_uuids = context.getAllUUIDs()</div>
<div class="line"><span class="keywordflow">for</span> i, uuid <span class="keywordflow">in</span> enumerate(all_uuids):</div>
<div class="line">    <span class="keywordflow">if</span> i &lt; len(results):</div>
<div class="line">        <span class="keywordflow">if</span> uuid <span class="keywordflow">in</span> leaf_uuids:</div>
<div class="line">            total_leaf_interception += results[i]</div>
<div class="line">        <span class="keywordflow">elif</span> uuid <span class="keywordflow">in</span> branch_uuids:</div>
<div class="line">            total_branch_interception += results[i]</div>
<div class="line"> </div>
<div class="line">print(f<span class="stringliteral">&quot;Leaf interception: {total_leaf_interception:.2f} W&quot;</span>)</div>
<div class="line">print(f<span class="stringliteral">&quot;Branch interception: {total_branch_interception:.2f} W&quot;</span>)</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md247"></a>
Data Storage</h2>
<div class="fragment"><div class="line"><span class="comment"># Store radiation results as primitive data</span></div>
<div class="line">results = radiation.get_total_absorbed_flux()</div>
<div class="line">all_uuids = context.getAllUUIDs()</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">for</span> i, uuid <span class="keywordflow">in</span> enumerate(all_uuids):</div>
<div class="line">    <span class="keywordflow">if</span> i &lt; len(results):</div>
<div class="line">        <span class="comment"># Store flux data</span></div>
<div class="line">        context.setPrimitiveDataFloat(uuid, <span class="stringliteral">&quot;radiation_flux_PAR&quot;</span>, results[i])</div>
<div class="line">        </div>
<div class="line">        <span class="comment"># Calculate flux density</span></div>
<div class="line">        area = context.getPrimitiveArea(uuid)</div>
<div class="line">        flux_density = results[i] / area <span class="keywordflow">if</span> area &gt; 0 <span class="keywordflow">else</span> 0</div>
<div class="line">        context.setPrimitiveDataFloat(uuid, <span class="stringliteral">&quot;flux_density_PAR&quot;</span>, flux_density)</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Use for visualization</span></div>
<div class="line">context.colorPrimitiveByDataPseudocolor(</div>
<div class="line">    all_uuids, <span class="stringliteral">&quot;flux_density_PAR&quot;</span>, <span class="stringliteral">&quot;hot&quot;</span>, 256</div>
<div class="line">)</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md248"></a>
Error Handling</h1>
<div class="fragment"><div class="line"><span class="keyword">from</span> <a class="code hl_namespace" href="namespacepyhelios_1_1exceptions.html">pyhelios.exceptions</a> <span class="keyword">import</span> HeliosGPUInitializationError</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">try</span>:</div>
<div class="line">    radiation = RadiationModel(context)</div>
<div class="line">    </div>
<div class="line"><span class="keywordflow">except</span> RadiationModelError <span class="keyword">as</span> e:</div>
<div class="line">    print(f<span class="stringliteral">&quot;RadiationModel initialization failed: {e}&quot;</span>)</div>
<div class="line">    </div>
<div class="line">    <span class="comment"># Check if GPU is available</span></div>
<div class="line">    <span class="keywordflow">if</span> <span class="stringliteral">&quot;NVIDIA GPU&quot;</span> <span class="keywordflow">in</span> str(e):</div>
<div class="line">        print(<span class="stringliteral">&quot;Ensure NVIDIA GPU with CUDA support is available&quot;</span>)</div>
<div class="line">    <span class="keywordflow">elif</span> <span class="stringliteral">&quot;OptiX&quot;</span> <span class="keywordflow">in</span> str(e):</div>
<div class="line">        print(<span class="stringliteral">&quot;OptiX runtime error - check graphics drivers&quot;</span>)</div>
<div class="line">        </div>
<div class="line"><span class="keywordflow">except</span> HeliosGPUInitializationError <span class="keyword">as</span> e:</div>
<div class="line">    print(f<span class="stringliteral">&quot;GPU initialization failed: {e}&quot;</span>)</div>
<div class="ttc" id="anamespacepyhelios_1_1exceptions_html"><div class="ttname"><a href="namespacepyhelios_1_1exceptions.html">pyhelios.exceptions</a></div><div class="ttdef"><b>Definition</b> <a href="exceptions_8py_source.html#l00001">exceptions.py:1</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md249"></a>
Performance Optimization</h1>
<div class="fragment"><div class="line"><span class="comment"># Optimize for different scenarios</span></div>
<div class="line">scenarios = {</div>
<div class="line">    <span class="stringliteral">&quot;interactive&quot;</span>: {</div>
<div class="line">        <span class="stringliteral">&quot;direct_rays&quot;</span>: 100,</div>
<div class="line">        <span class="stringliteral">&quot;diffuse_rays&quot;</span>: 300,</div>
<div class="line">        <span class="stringliteral">&quot;scattering_depth&quot;</span>: 1</div>
<div class="line">    },</div>
<div class="line">    <span class="stringliteral">&quot;production&quot;</span>: {</div>
<div class="line">        <span class="stringliteral">&quot;direct_rays&quot;</span>: 2000,</div>
<div class="line">        <span class="stringliteral">&quot;diffuse_rays&quot;</span>: 6000, </div>
<div class="line">        <span class="stringliteral">&quot;scattering_depth&quot;</span>: 2</div>
<div class="line">    },</div>
<div class="line">    <span class="stringliteral">&quot;research&quot;</span>: {</div>
<div class="line">        <span class="stringliteral">&quot;direct_rays&quot;</span>: 10000,</div>
<div class="line">        <span class="stringliteral">&quot;diffuse_rays&quot;</span>: 30000,</div>
<div class="line">        <span class="stringliteral">&quot;scattering_depth&quot;</span>: 3</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment"># Apply scenario</span></div>
<div class="line">scenario = scenarios[<span class="stringliteral">&quot;production&quot;</span>]</div>
<div class="line">radiation.set_direct_ray_count(<span class="stringliteral">&quot;PAR&quot;</span>, scenario[<span class="stringliteral">&quot;direct_rays&quot;</span>])</div>
<div class="line">radiation.set_diffuse_ray_count(<span class="stringliteral">&quot;PAR&quot;</span>, scenario[<span class="stringliteral">&quot;diffuse_rays&quot;</span>])</div>
<div class="line">radiation.set_scattering_depth(<span class="stringliteral">&quot;PAR&quot;</span>, scenario[<span class="stringliteral">&quot;scattering_depth&quot;</span>])</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md250"></a>
Build Requirements</h1>
<div class="fragment"><div class="line"># Build with radiation plugin</div>
<div class="line">build_scripts/build_helios --plugins radiation</div>
<div class="line"> </div>
<div class="line"># Or use GPU profile</div>
<div class="line">build_scripts/build_helios --profile gpu-accelerated</div>
<div class="line"> </div>
<div class="line"># Check if radiation is available</div>
<div class="line">python -c &quot;from pyhelios.plugins import get_plugin_registry; print(get_plugin_registry().is_plugin_available(&#39;radiation&#39;))&quot;</div>
</div><!-- fragment --><p>This documentation covers the actual RadiationModel implementation in PyHelios, verified against the wrapper code and high-level interface. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
