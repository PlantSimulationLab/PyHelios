#!/bin/bash
# Cross-platform Python executable detection for build_helios.py
# This wrapper ensures the build script "just works" regardless of python/python3 setup

set -e

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
BUILD_SCRIPT="$SCRIPT_DIR/build_helios.py"

# Function to check if a command exists
command_exists() {
    command -v "$1" >/dev/null 2>&1
}

# Try to find the best Python executable
PYTHON_CMD=""

# Priority order: python3, python, py (Windows)
if command_exists python3; then
    PYTHON_CMD="python3"
elif command_exists python; then
    # Verify it's Python 3.x
    if python -c "import sys; sys.exit(0 if sys.version_info[0] >= 3 else 1)" 2>/dev/null; then
        PYTHON_CMD="python"
    else
        echo "Error: Found 'python' but it's Python 2.x. PyHelios requires Python 3.6+." >&2
        echo "Please install Python 3 or use 'python3 build_scripts/build_helios.py' directly." >&2
        exit 1
    fi
elif command_exists py; then
    # Windows Python Launcher
    PYTHON_CMD="py -3"
else
    echo "Error: No Python 3 interpreter found." >&2
    echo "Please install Python 3.6+ and ensure it's available as 'python3' or 'python'." >&2
    exit 1
fi

# Execute the actual build script with the detected Python
echo "Using Python: $PYTHON_CMD"
exec $PYTHON_CMD "$BUILD_SCRIPT" "$@"